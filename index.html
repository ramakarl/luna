<html>

  <meta charset='utf-8'>

  <head>

    <!-- <link href="css/simple.css" rel="stylesheet" type="text/css" /> -->

    <script src='lib/jquery.js'></script>
    <script src='lib/jquery.mousewheel.js'/></script>
    <script src='lib/jquery.capslockstate.js'/></script>
    <script src='lib/numeric.js'></script>
    <script src='lib/oop.js'></script>

    <script src='gui/guiRegion.js'></script>
    <script src='gui/guiPalette.js'></script>
    <script src='gui/guiComponentTile.js'></script>
    <script src='gui/guiList.js'></script>
    <script src='gui/guiScrollbar.js'></script>
    <script src='gui/guiIcon.js'></script>
    <script src='gui/guiDropIcon.js'></script>
    <script src='gui/guiToolbox.js'></script>
    <script src='gui/guiGrid.js'></script>
    <script src='gui/guiTextbox.js'></script>
    <script src='gui/guiAction.js'></script>

    <script src='tools/toolNav.js'></script>

    <script src='luna_render.js'></script>
    <script src='luna_input.js'></script>

    <script>

    var drawing = true,
        running = true,
        mouseDown = false,
        visible = true;

    var msec = 0;
    var frame = 0;
    var lastTime = new Date();

    var g_painter = null;
    var g_canvas;
    var g_context;
    var g_nav = new toolNav();
    var g_root = null;

    var g_input = null;

    function loop() {

      frame = frame + 1;
      if ( frame >= 30 ) {
        var d = new Date();
        msec = (d.getTime() - lastTime ) / frame;
        lastTime = d;
        frame = 0;
      }

      var container = document.querySelector( 'section' );
      container.innerHTML = "FPS: " + (1000.0/msec);

      g_painter.startDraw ();
      g_painter.drawGrid();
      g_root.drawChildren();

      requestAnimationFrame( loop, 1 );
    }

    $(document).ready( function() {
      console.log("ready");

    // Get the canvas/context
      var cvs = document.getElementById('canvas');
      cvs.onselectstart = function() { return false; }
      g_canvas = $( "#canvas" )[0];
      g_context = g_canvas.getContext('2d');

      // Luna render
      g_painter = new lunaRender( g_canvas.width, g_canvas.height, g_context );

      // Luna scene root
      g_root = new guiRegion ( "root", g_context );
      g_root.setSize ( 0, 0, g_canvas.width, g_canvas.height );

      // Luna input root
      g_input = new lunaInput( "canvas", g_root );

      // TESTING
      testa = new guiRegion ( "a", g_context );
      testa.setSize ( 80, 20, 150, 200 );
      testa.setBackClr ( 1, 0, 0, 0.2 );
      testa.setClip ( true );
      g_root.addChild ( testa );

      testb = new guiRegion ( "b", g_context );
      testb.setSize ( 30, 60, 150, 100 );
      testb.setBackClr ( 0, 1, 0, 0.2 );
      testb.setClip ( true );
      g_root.addChild ( testb );

      testc = new guiRegion ( "c", g_context );
      testc.setSize ( 90, 120, 200, 200 );
      testc.setBackClr ( 0, 0, 1, 0.2 );
      testc.setClip ( true );
      testa.addChild ( testc );



      requestAnimationFrame( loop, 1 );
    });

    if ( !window.requestAnimationFrame ) {
      window.requestAnimationFrame = ( function() {

        return window.webkitRequestAnimationFrame ||
        window.mozRequestAnimationFrame ||
        window.oRequestAnimationFrame ||
        window.msRequestAnimationFrame ||
        function( callback, element ) {
          window.setTimeout( callback, 1000 );
        };

      } )();
    }


    </script>
  </head>

  <body>

    <!-- download hacking -->
    <iframe id='downloadFrame' style='display:none'></iframe>
    <canvas id='canvas' width='1200' height='700' style='border:1px solid #111;' tabindex='0'> </canvas>
    <section></section>
    <button id='btn' onclick='btn_func();' >f</button>

  </body>

</html>
